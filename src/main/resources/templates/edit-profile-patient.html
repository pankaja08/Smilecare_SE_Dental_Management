<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edit Profile | Smilecare Dental</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary: #2c7fb8;
            --primary-light: #5fa8d3;
            --secondary: #f8f9fa;
            --accent: #ff9f1c;
            --text: #333;
            --text-light: #6c757d;
            --danger: #e74c3c;
            --success: #2ecc71;
            --border: #e0e0e0;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
<div class="container mx-auto px-4 py-8">
    <!-- Header -->
    <div class="flex justify-between items-center mb-8">
        <h1 class="text-3xl font-bold text-[#2c7fb8] flex items-center gap-3">
            <i class="fas fa-user-edit"></i> Edit Profile
        </h1>
        <a th:href="@{/users/profile}"
           class="bg-gray-500 text-white px-6 py-3 rounded-lg hover:bg-gray-600 transition-colors">
            <i class="fas fa-arrow-left mr-2"></i> Back to Profile
        </a>
    </div>

    <!-- Messages -->
    <div th:if="${error}" class="bg-red-50 border border-red-200 rounded-lg p-4 mb-6">
        <div class="flex items-center space-x-3">
            <div class="w-5 h-5 flex items-center justify-center text-red-600">
                <i class="fas fa-exclamation-circle"></i>
            </div>
            <div class="text-sm text-red-800">
                <span th:text="${error}"></span>
            </div>
        </div>
    </div>

    <div th:if="${success}" class="bg-green-50 border border-green-200 rounded-lg p-4 mb-6">
        <div class="flex items-center space-x-3">
            <div class="w-5 h-5 flex items-center justify-center text-green-600">
                <i class="fas fa-check-circle"></i>
            </div>
            <div class="text-sm text-green-800">
                <span th:text="${success}"></span>
            </div>
        </div>
    </div>

    <!-- Edit Form -->
    <div class="max-w-4xl mx-auto">
        <div class="bg-white rounded-xl shadow-lg p-8">
            <!-- FIXED: Simple POST method -->
            <form th:action="@{/users/update/{id}(id=${user.id})}" th:object="${user}" method="post" class="space-y-6">

                <!-- Profile Picture Section -->
                <div class="text-center mb-8">
                    <div class="relative inline-block">
                        <img th:src="@{/image/profile_icon.png}"
                             alt="Profile Image"
                             class="w-32 h-32 rounded-full object-cover border-4 border-[#5fa8d3] mx-auto">
                        <button type="button" class="absolute bottom-2 right-2 bg-[#2c7fb8] text-white p-2 rounded-full hover:bg-[#5fa8d3] transition-colors">
                            <i class="fas fa-camera"></i>
                        </button>
                    </div>
                    <p class="text-gray-600 mt-2">Click the camera icon to change profile picture</p>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Full Name -->
                    <div class="md:col-span-2">
                        <label for="fullName" class="block text-sm font-medium text-gray-700 mb-2">
                            Full Name <span class="text-red-500">*</span>
                        </label>
                        <input type="text" id="fullName" th:field="*{fullName}"
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#2c7fb8] focus:border-[#2c7fb8] outline-none transition-colors"
                               required>
                        <div class="text-red-500 text-sm mt-1" th:if="${#fields.hasErrors('fullName')}" th:errors="*{fullName}"></div>
                    </div>

                    <!-- Date of Birth -->
                    <div>
                        <label for="dob" class="block text-sm font-medium text-gray-700 mb-2">
                            Date of Birth <span class="text-red-500">*</span>
                        </label>
                        <input type="date" id="dob" th:field="*{dob}"
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#2c7fb8] focus:border-[#2c7fb8] outline-none transition-colors"
                               required>
                        <div class="text-red-500 text-sm mt-1" th:if="${#fields.hasErrors('dob')}" th:errors="*{dob}"></div>
                    </div>

                    <!-- Gender -->
                    <div>
                        <label for="gender" class="block text-sm font-medium text-gray-700 mb-2">
                            Gender <span class="text-red-500">*</span>
                        </label>
                        <select id="gender" th:field="*{gender}"
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#2c7fb8] focus:border-[#2c7fb8] outline-none transition-colors"
                                required>
                            <option value="">Select Gender</option>
                            <option value="Male">Male</option>
                            <option value="Female">Female</option>
                            <option value="Other">Other</option>
                        </select>
                        <div class="text-red-500 text-sm mt-1" th:if="${#fields.hasErrors('gender')}" th:errors="*{gender}"></div>
                    </div>

                    <!-- Contact Number -->
                    <div>
                        <label for="contactNumber" class="block text-sm font-medium text-gray-700 mb-2">
                            Contact Number <span class="text-red-500">*</span>
                        </label>
                        <input type="tel" id="contactNumber" th:field="*{contactNumber}"
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#2c7fb8] focus:border-[#2c7fb8] outline-none transition-colors"
                               required>
                        <div class="text-red-500 text-sm mt-1" th:if="${#fields.hasErrors('contactNumber')}" th:errors="*{contactNumber}"></div>
                    </div>

                    <!-- Email -->
                    <div>
                        <label for="email" class="block text-sm font-medium text-gray-700 mb-2">
                            Email Address <span class="text-red-500">*</span>
                        </label>
                        <input type="email" id="email" th:field="*{email}"
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#2c7fb8] focus:border-[#2c7fb8] outline-none transition-colors"
                               required>
                        <div class="text-red-500 text-sm mt-1" th:if="${#fields.hasErrors('email')}" th:errors="*{email}"></div>
                    </div>

                    <!-- Username (Read-only) -->
                    <div>
                        <label for="username" class="block text-sm font-medium text-gray-700 mb-2">
                            Username
                        </label>
                        <input type="text" id="username" th:field="*{username}"
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg bg-gray-100 cursor-not-allowed"
                               readonly>
                        <p class="text-gray-500 text-sm mt-1">Username cannot be changed</p>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="flex gap-4 pt-6">
                    <!-- FIXED: Changed from <a> to <button type="submit"> -->
                    <button type="submit"
                            class="flex-1 bg-[#2c7fb8] text-white py-4 px-6 rounded-lg font-semibold hover:bg-[#5fa8d3] transition-colors flex items-center justify-center gap-2">
                        <i class="fas fa-save"></i> Save Changes
                    </button>
                    <a th:href="@{/users/profile}"
                       class="flex-1 bg-gray-500 text-white py-4 px-6 rounded-lg font-semibold hover:bg-gray-600 transition-colors flex items-center justify-center gap-2">
                        <i class="fas fa-times"></i> Cancel
                    </a>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    // Profile picture upload functionality
    document.addEventListener('DOMContentLoaded', function() {
        const profileImg = document.querySelector('img');
        const cameraBtn = document.querySelector('button[type="button"]');

        cameraBtn.addEventListener('click', function() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*';

            input.addEventListener('change', function(event) {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        profileImg.src = e.target.result;
                        alert('Profile picture updated! (This would upload to server in production)');
                    };
                    reader.readAsDataURL(file);
                }
            });

            input.click();
        });

        // Form validation
        const form = document.querySelector('form');
        form.addEventListener('submit', function(event) {
            let isValid = true;
            const requiredFields = form.querySelectorAll('[required]');

            requiredFields.forEach(field => {
                if (!field.value.trim()) {
                    isValid = false;
                    field.classList.add('border-red-500');
                } else {
                    field.classList.remove('border-red-500');
                }
            });

            if (!isValid) {
                event.preventDefault();
                alert('Please fill in all required fields.');
            }
        });
    });
</script>
</body>
</html>